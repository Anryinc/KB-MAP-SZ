<!DOCTYPE html>
<html>
<head>
    <title>Карта сотрудников</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 900px; width: 100%; }
        .city-label {
            font-size: 14px;
            font-weight: bold;
            color: #2C3959;
            text-align: center;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 5px;
            border: 2px solid #FF6240; /* Обводка цветом пина */
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            Promise.all([
                fetch('employees.json').then(res => res.json()),
                fetch('cities_coordinates.json').then(res => res.json())
            ]).then(([cities, citiesCoords]) => {
                const map = L.map('map').setView([55.7558, 37.6176], 5);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                cities.forEach(city => {
                    const coordinates = citiesCoords[city.name];
                    if (coordinates) {
                        // Добавляем название города над пином, центрируя его
                        L.marker([coordinates[0] + 0.05, coordinates[1]], {
                            icon: L.divIcon({
                                className: 'city-label',
                                html: `${city.name}`,
                                iconSize: null
                            })
                        }).addTo(map);

                        // Добавляем сам пин
                        L.circleMarker(coordinates, {
                            radius: 8,
                            fillColor: "#FF6240",
                            color: "black",
                            weight: 2,
                            fillOpacity: 1
                        }).addTo(map)
                        .bindPopup(`
                            <div style="background: #2C3959; color: white; padding: 5px; border-radius: 5px;"> 
                                <b>${city.name}</b><br>
                                ${city.employees.map(e => `${e.name} (${e.department})`).join('<br>')}
                            </div>
                        `);
                    }
                });
            });
        });
    </script>
</body>
</html>
