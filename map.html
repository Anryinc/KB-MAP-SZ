<!DOCTYPE html>
<html>
<head>
    <title>Карта сотрудников</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 900px; width: 100%; }
        .city-label {
            font-size: 14px;
            font-weight: bold;
            color: #2C3959;
            text-align: center;
            white-space: nowrap;
            position: absolute;
            transform: translate(-50%, -30px);
            background: rgba(255, 255, 255, 0.7);
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            Promise.all([
                fetch('employees.json').then(res => res.json()),
                fetch('cities_coordinates.json').then(res => res.json())
            ]).then(([cities, citiesCoords]) => {
                const map = L.map('map').setView([55.7558, 37.6176], 5);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                cities.forEach(city => {
                    const coordinates = citiesCoords[city.name];
                    if (coordinates) {
                        const marker = L.marker(coordinates, {
                            icon: L.divIcon({
                                className: '',
                                html: `<div class="city-label">${city.name}</div>`,
                                iconSize: [100, 20],
                                iconAnchor: [50, 40] // Центрируем текст над пином
                            })
                        }).addTo(map);

                        L.marker(coordinates, {
                            icon: L.circleMarker(coordinates, {
                                radius: 8,
                                fillColor: "#FF6240",
                                color: "black",
                                weight: 2,
                                fillOpacity: 1
                            })
                        }).addTo(map)
                        .bindPopup(`
                            <div style="background: #2C3959; color: white; padding: 5px;"> 
                                <b>${city.name}</b><br>
                                ${city.employees.map(e => `${e.name} (${e.department})`).join('<br>')}
                            </div>
                        `);
                    }
                });
            });
        });
    </script>
</body>
</html>
